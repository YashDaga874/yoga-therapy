{% extends "base.html" %}

{% block title %}Import Data{% endblock %}

{% block content %}
<h2 style="margin-bottom: 1rem;">Bulk Import</h2>
<p style="color: #555; margin-bottom: 1.5rem;">
    Upload CSV or XLSX to add/update modules, practices, contraindications, or RCTs.
    Existing records are matched and updated; new rows are created. Duplicates are skipped.
    Use UTF-8 CSV for maximum compatibility.
    <br><strong>Tip:</strong> Keep a backup of your database before large imports.
</p>

<form method="POST" enctype="multipart/form-data" style="padding: 1.25rem; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 2rem;">
    <div class="form-group" style="margin-bottom: 1rem;">
        <label style="font-weight: 600;">What are you importing?</label>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
            <label><input type="radio" name="import_type" value="modules" required> Modules</label>
            <label><input type="radio" name="import_type" value="practices"> Practices</label>
            <label><input type="radio" name="import_type" value="contraindications"> Contraindications</label>
            <label><input type="radio" name="import_type" value="rcts"> RCTs</label>
        </div>
    </div>

    <div class="form-group" style="margin-bottom: 1rem;">
        <label for="data_file" style="font-weight: 600;">CSV / XLSX file</label>
        <input type="file" id="data_file" name="data_file" accept=".csv,.xlsx,.xlsm" required>
        <small style="color: #666;">First row must be headers. UTF-8 CSV recommended.</small>
    </div>

    <button type="submit" class="btn">Upload &amp; Import</button>
</form>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem;">
    <div style="padding: 1rem; border: 1px solid #e9ecef; border-radius: 8px; background: #fff;">
        <h4 style="margin-bottom: 0.5rem;">Modules</h4>
        <ul style="margin-left: 1rem; color: #555; line-height: 1.5;">
            <li>Required module columns: <code>disease_name</code>, <code>developed_by</code>; optional: <code>paper_link</code>, <code>module_description</code>.</li>
            <li>Add practice columns on the same row to import the full module: <code>practice_english</code> (or <code>practice_sanskrit</code>), <code>practice_segment</code>/<code>category</code>, <code>kosha</code>, <code>sub_category</code>, <code>code</code>, <code>rounds</code>, <code>time_minutes</code>, <code>strokes_per_min</code>, <code>strokes_per_cycle</code>, <code>rest_between_cycles_sec</code>, <code>cvr_score</code>, <code>practice_description</code>, <code>how_to_do</code>, <code>variations</code>, <code>steps</code> (variations/steps accept comma/pipe lists).</li>
            <li>Use one row per practice; repeat module columns for that module. Leaving practice columns empty imports/updates only the module metadata.</li>
        </ul>
    </div>

    <div style="padding: 1rem; border: 1px solid #e9ecef; border-radius: 8px; background: #fff;">
        <h4 style="margin-bottom: 0.5rem;">Practices</h4>
        <ul style="margin-left: 1rem; color: #555; line-height: 1.5;">
            <li>Required: <code>practice_english</code> (or <code>practice_sanskrit</code>), <code>practice_segment</code>/<code>category</code></li>
            <li>Optional: <code>practice_sanskrit</code>, <code>code</code>, <code>sub_category</code>, <code>kosha</code>, <code>diseases</code> (comma/pipe list), <code>module_developed_by</code>, <code>description</code>, <code>how_to_do</code></li>
            <li>Matches by code, then Sanskrit, then English+segment; fills missing fields and links diseases.</li>
            <li>New rows auto-generate practice code if missing.</li>
        </ul>
    </div>

    <div style="padding: 1rem; border: 1px solid #e9ecef; border-radius: 8px; background: #fff;">
        <h4 style="margin-bottom: 0.5rem;">Contraindications</h4>
        <ul style="margin-left: 1rem; color: #555; line-height: 1.5;">
            <li>Required: <code>disease_name</code>, <code>practice_english</code>, <code>practice_segment</code>/<code>category</code></li>
            <li>Optional: <code>practice_sanskrit</code>, <code>sub_category</code>, <code>reason</code>, <code>source_type</code>, <code>source_name</code>, <code>apa_citation</code></li>
            <li>Duplicates (same disease + practice + segment) are updated instead of duplicated.</li>
        </ul>
    </div>

    <div style="padding: 1rem; border: 1px solid #e9ecef; border-radius: 8px; background: #fff;">
        <h4 style="margin-bottom: 0.5rem;">RCTs</h4>
        <ul style="margin-left: 1rem; color: #555; line-height: 1.5;">
            <li>Required: <code>title</code></li>
            <li>Helpful: <code>doi</code>, <code>citation_full</code>, <code>parenthetical_citation</code>, <code>database_journal</code>, <code>study_type</code>, <code>participant_type</code>, <code>duration_type</code>, <code>duration_value</code>, <code>frequency_per_duration</code>, <code>results</code>, <code>conclusion</code>, <code>remarks</code>, <code>diseases</code> (comma/pipe list)</li>
            <li>Matches existing by DOI, then title; otherwise creates new entry and links diseases.</li>
        </ul>
    </div>
</div>
{% endblock %}
