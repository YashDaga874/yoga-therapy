{% extends "base.html" %}

{% block title %}Practice Recommendations{% endblock %}

{% block content %}
<h2>Practice Recommendations</h2>

<div style="margin-bottom: 3rem;">
    <!-- Disease Names -->
    <div style="margin-bottom: 2rem; padding: 1.5rem; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #2196F3;">
        <h3 style="margin-bottom: 1rem; color: #2c3e50;">Disease Information</h3>
        <div style="margin-bottom: 1rem;">
            <strong style="font-size: 1.1rem; color: #495057;">Major Disease:</strong>
            <span style="font-size: 1.1rem; color: #667eea; margin-left: 0.5rem;">{{ major_disease_name }}</span>
        </div>
        {% if comorbid_disease_names %}
        <div>
            <strong style="font-size: 1.1rem; color: #495057;">Co-morbid Diseases:</strong>
            <div style="margin-top: 0.5rem;">
                {% for disease_name in comorbid_disease_names %}
                <span style="display: inline-block; padding: 0.5rem 1rem; background: #667eea; color: white; border-radius: 20px; margin-right: 0.5rem; margin-bottom: 0.5rem; font-size: 1rem;">
                    {{ disease_name }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Contraindications -->
    {% if contraindications %}
    <div style="margin-bottom: 2rem; padding: 1.5rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
        <h3 style="margin-bottom: 1rem; color: #856404;">Contraindications</h3>
        <p style="color: #856404; margin-bottom: 1rem;">The following practices should be avoided:</p>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #ffc107; color: #856404;">
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Practice</th>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Category</th>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Citation</th>
                </tr>
            </thead>
            <tbody>
                {% for contra in contraindications %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 0.75rem; border: 1px solid #ddd;">
                        <strong>{{ contra.practice_english }}</strong>
                        {% if contra.practice_sanskrit %}
                        <br><small style="color: #666;">({{ contra.practice_sanskrit }})</small>
                        {% endif %}
                    </td>
                    <td style="padding: 0.75rem; border: 1px solid #ddd;">{{ contra.practice_segment }}</td>
                    <td style="padding: 0.75rem; border: 1px solid #ddd;">
                        {% if contra.apa_citation %}
                            {{ contra.apa_citation }}
                        {% elif contra.source_name %}
                            {{ contra.source_name }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>

<!-- Practices Organized by Kosha -->
<div style="margin-bottom: 2rem;">
    <h3 style="margin-bottom: 1.5rem; color: #2c3e50;">Recommended Practices</h3>
    
    {% if organized_practices %}
        {% for kosha in sorted_koshas %}
        <div style="margin-bottom: 2.5rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
            <h4 style="margin-bottom: 1rem; color: #667eea; font-size: 1.3rem;">{{ kosha }}</h4>
            
            {% for category, subcategories in organized_practices[kosha].items()|sort %}
            <div style="margin-bottom: 1.5rem; margin-left: 1rem;">
                <h5 style="margin-bottom: 0.75rem; color: #495057; font-size: 1.1rem;">{{ category }}</h5>
                
                {% for subcategory, practices_list in subcategories.items()|sort %}
                <div style="margin-bottom: 1rem; margin-left: 1rem;">
                    {% if subcategory != 'None' %}
                    <h6 style="margin-bottom: 0.5rem; color: #666; font-size: 1rem; font-style: italic;">{{ subcategory }}</h6>
                    {% endif %}
                    
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 6px; overflow: hidden;">
                        <thead>
                            <tr style="background: #667eea; color: white;">
                                <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">Practice</th>
                                <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd;">RCTs</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in practices_list %}
                            {% set practice = item.practice %}
                            {% set rcts = item.rcts %}
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 0.75rem; border: 1px solid #ddd;">
                                    <strong>{{ practice.practice_english }}</strong>
                                    {% if practice.practice_sanskrit %}
                                    <br><small style="color: #666;">({{ practice.practice_sanskrit }})</small>
                                    {% endif %}
                                </td>
                                <td style="padding: 0.75rem; border: 1px solid #ddd;">
                                    {% if rcts %}
                                        {% for rct_citation in rcts %}
                                        <div style="margin-bottom: 0.25rem;">{{ rct_citation }}</div>
                                        {% endfor %}
                                    {% else %}
                                        <span style="color: #999;">No RCT citations available</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    {% else %}
    <div style="padding: 2rem; text-align: center; background: #f8f9fa; border-radius: 8px;">
        <p style="color: #666; font-size: 1.1rem;">No practices found for the selected modules.</p>
    </div>
    {% endif %}
</div>

<div style="margin-top: 2rem;">
    <a href="/recommendations" class="btn" style="padding: 0.75rem 2rem; font-size: 1rem;">
        Generate New Recommendations
    </a>
</div>
{% endblock %}

