{% extends "base.html" %}

{% block title %}Edit Contraindication{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h2>Edit Contraindication</h2>
    <form method="POST" action="/contraindication/{{ contraindication.id }}/delete" style="display: inline;" 
          onsubmit="return confirm('Are you sure you want to delete this contraindication?')">
        <button type="submit" class="btn" style="background: #dc3545;">Delete Contraindication</button>
    </form>
</div>

<form method="POST" style="max-width: 800px;">
    <div class="form-group">
        <label for="practice_sanskrit">Practice Name (Sanskrit)</label>
        <input type="text" id="practice_sanskrit" name="practice_sanskrit" 
               value="{{ contraindication.practice_sanskrit or '' }}" placeholder="e.g., Shavasana">
    </div>
    
    <div class="form-group">
        <label for="practice_english">Practice Name (English) *</label>
        <input type="text" id="practice_english" name="practice_english" required
               value="{{ contraindication.practice_english }}" placeholder="e.g., Corpse pose">
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <div class="form-group">
            <label for="practice_segment">Practice Segment *</label>
            <select id="practice_segment" name="practice_segment" required>
                <option value="">Select Practice Segment</option>
                <option value="Preparatory Practice" {% if contraindication.practice_segment == 'Preparatory Practice' %}selected{% endif %}>Preparatory Practice</option>
                <option value="Breathing Practice" {% if contraindication.practice_segment == 'Breathing Practice' %}selected{% endif %}>Breathing Practice</option>
                <option value="Suryanamaskara" {% if contraindication.practice_segment == 'Suryanamaskara' %}selected{% endif %}>Suryanamaskara</option>
                <option value="Yogasana" {% if contraindication.practice_segment == 'Yogasana' %}selected{% endif %}>Yogasana</option>
                <option value="Pranayama" {% if contraindication.practice_segment == 'Pranayama' %}selected{% endif %}>Pranayama</option>
                <option value="Meditation" {% if contraindication.practice_segment == 'Meditation' %}selected{% endif %}>Meditation</option>
                <option value="Additional Practices" {% if contraindication.practice_segment == 'Additional Practices' %}selected{% endif %}>Additional Practices</option>
                <option value="Kriya (Cleansing Techniques)" {% if contraindication.practice_segment == 'Kriya (Cleansing Techniques)' %}selected{% endif %}>Kriya (Cleansing Techniques)</option>
                <option value="Yogic Counselling" {% if contraindication.practice_segment == 'Yogic Counselling' %}selected{% endif %}>Yogic Counselling</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="sub_category">Sub-Category</label>
            <input type="text" id="sub_category" name="sub_category" value="{{ contraindication.sub_category or '' }}">
        </div>
    </div>
    
    <div class="form-group">
        <label for="reason">Reason for Contraindication</label>
        <textarea id="reason" name="reason" 
                  placeholder="Why is this practice contraindicated?">{{ contraindication.reason or '' }}</textarea>
    </div>
    
    <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Source Information</h3>
    
    <div class="form-group">
        <label for="source_type">Type of Source *</label>
        <select id="source_type" name="source_type" required>
            <option value="">Select Source Type</option>
            <option value="book" {% if contraindication.source_type == 'book' %}selected{% endif %}>Book</option>
            <option value="paper" {% if contraindication.source_type == 'paper' %}selected{% endif %}>Research Paper</option>
            <option value="ancient_text" {% if contraindication.source_type == 'ancient_text' %}selected{% endif %}>Ancient Text</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="source_name">Name of Source / Link *</label>
        <input type="text" id="source_name" name="source_name" required
               value="{{ contraindication.source_name or '' }}"
               placeholder="Book name, paper title, or link">
    </div>
    
    <div class="form-group" id="page-number-group" style="display: none;">
        <label for="page_number">Page Number / Range</label>
        <input type="text" id="page_number" name="page_number" 
               value="{{ contraindication.page_number or '' }}"
               placeholder="e.g., 45 or 45-47">
    </div>
    
    <div class="form-group" id="apa-citation-group" style="display: none;">
        <label for="apa_citation">APA Citation</label>
        <textarea id="apa_citation" name="apa_citation" 
                  placeholder="Full APA citation format">{{ contraindication.apa_citation or '' }}</textarea>
    </div>
    
    <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1.5rem;">
        <h4 style="margin-bottom: 1rem;">For Which Diseases *</h4>
        <p style="color: #666; margin-bottom: 1rem;">Select which disease(s) this contraindication applies to:</p>
        
        {% for disease in diseases %}
        <div style="margin-bottom: 0.5rem;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="diseases" value="{{ disease.id }}" 
                       {% if disease in contraindication.diseases %}checked{% endif %}
                       style="margin-right: 0.5rem;">
                {{ disease.name }}
            </label>
        </div>
        {% endfor %}
    </div>
    
    <div style="display: flex; gap: 1rem;">
        <button type="submit" class="btn">Update Contraindication</button>
        <a href="/contraindications" class="btn btn-secondary">Cancel</a>
    </div>
</form>

<script>
// Toggle page number and APA citation fields based on source type
const sourceTypeSelect = document.getElementById('source_type');
const pageNumberGroup = document.getElementById('page-number-group');
const apaCitationGroup = document.getElementById('apa-citation-group');

function toggleFields() {
    const sourceType = sourceTypeSelect.value;
    if (sourceType === 'book') {
        pageNumberGroup.style.display = 'block';
        apaCitationGroup.style.display = 'block';
    } else if (sourceType === 'paper') {
        pageNumberGroup.style.display = 'none';
        apaCitationGroup.style.display = 'block';
    } else {
        pageNumberGroup.style.display = 'none';
        apaCitationGroup.style.display = 'none';
    }
}

// Initialize fields on page load
toggleFields();

sourceTypeSelect.addEventListener('change', toggleFields);
</script>
{% endblock %}
